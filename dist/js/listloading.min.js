"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e():t.Listloading=e()}(void 0,function(){function t(t){var e=Date.parse(new Date),l=(e-t)/1e3,i=parseInt(l/86400),n=parseInt(l/3600),o=parseInt(l/60),s=parseInt(l);if(i>0&&i<4)return i+"天前";if(i<=0&&n>0)return n+"小时前";if(n<=0&&o>0)return o+"分钟前";if(o<=0&&s>=0)return"刚刚之前";var r=new Date(t);return r.getFullYear()+"年"+(r.getMonth()+1)+"月"+r.getDate()+"日 "+r.getHours()+"::"+r.getMinutes()+":"+r.getSeconds()}function e(t,e){this.ele=document.querySelector(t);var l=this.ele.getAttribute("id");if(l||(l="listLoading"+Math.random().toString().replace("0.",""),this.ele.setAttribute("id",l)),this.id=l,this.children=this.ele.children[0],"object"!==(void 0===e?"undefined":_typeof(e))||!n.isFunction(e.pullDownAction)){var i=e?e.iscrollOptions||{}:{};return i.mouseWheel=!0,this.iscroll=new IScroll("#"+l,i),this.iscroll}this.pullUpId="pullUp-"+l,this.pullDownId="pullDown-"+l,this.init(e)}var l=function(){var t,e,l,i,n,o;return e={},o=this,t=function(t,l){var i,n;return i=null!=(n=e[t])?n:e[t]=[],i.push(l)},l=function(e,l){return i(e),t(e,l)},i=function(t){var l;return null!=(l=e[t])?l.length=0:void 0},n=function(){var t,l,i,n,s,r;for(r=Array.prototype.shift.call(arguments),l=null!=(s=e[r])?s:e[r]=[],i=0,n=l.length;i<n;i++){if(void 0==(t=l[i]))return!1;if(!1===t.apply(o,arguments))return!1}},{listen:t,one:l,remove:i,trigger:n}}(),i={};"Boolean Number String Function Array Date RegExp Object Error".split(" ").forEach(function(t,e){i["[object "+t+"]"]=t.toLowerCase()});var n={isFunction:function(t){return"function"===this.type(t)},type:function(t){return null==t?String(t):i[toString.call(t)]||"object"},parseStringToHTML:function(t){var e,l=document.createElement("div"),i=document.createDocumentFragment();for(l.innerHTML=t;e=l.firstChild;)i.appendChild(e);return i},hasClass:function(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)},deepExtend:function(t){t=t||{};for(var e=1;e<arguments.length;e++){var l=arguments[e];if(l)for(var i in l)l.hasOwnProperty(i)&&("object"===_typeof(l[i])?t[i]=this.deepExtend(t[i],l[i]):t[i]=l[i])}return t}};return e.prototype={version:"1.0.0",init:function(t){this.options={},this.options.upLoadmoretxt='<i class="icon-up"></i>上拉加载更多',this.options.pullDrefreshtxt='<i class="icon-down"></i>下拉加载更多',this.options.loadertxt='<i class="icon-loading"></i>正在加载更多',this.options.Realtimetxt="松开刷新",this.options.loaderendtxt="已显示完全部",this.options.viewHeight=parseFloat(getComputedStyle(this.ele).height),this.options.pullUpActionStr="pullUpActionStr"+this.id,this.options.pullDownActionStr="pullDownAction"+this.id,l.remove(this.options.pullUpActionStr),l.remove(this.options.pullDownActionStr),n.deepExtend(this.options,t),this.render()},render:function(){this.pullDownAction(!0)},destroy:function(){this.children.style.WebkitTransform="",this.children.style.transform="",document.querySelectorAll("#"+this.pullDownId+", #"+this.pullUpId).forEach(function(t){t.remove()}),this.iscroll.destroy()},refresh:function(t){this.createPullUpEle(t)},createPullUpEle:function(t){var e=this.options,l=this.children;l.style.minHeight="auto";var i=parseFloat(getComputedStyle(l).height),o=this.pullUpId,s=e.viewHeight,r=e.pullDownOffset,u=this.iscroll;if(e.minScrollHeight=s+r,this.pullUpEle)i<e.minScrollHeight&&(this.pullUpEle.remove(),this.pullUpEle=null,this.options.pullUpOffset=0,l.style.minHeight=e.minScrollHeight);else if(n.isFunction(e.pullUpAction)&&i>e.minScrollHeight){var a='<div id="'+o+'" data-class="pullUpId"><span class="pullUpLabel inlineblock-span">'+e.upLoadmoretxt+"</span></div>";l.append(n.parseStringToHTML(a)),this.pullUpEle=document.getElementById(o),e.pullUpOffset=this.pullUpEle.offsetHeight}else l.style.minHeight=e.minScrollHeight;u&&(this.pullUpEle&&!t&&(this.pullUpEle.style.height=0),u.refresh(),this.pullUpEle&&!t&&(this.pullUpEle.removeAttribute("style"),u.maxScrollY=u.maxScrollY-this.options.pullUpOffset),0!==u.y||t||this.resizeAnimate())},createPullIScroll:function(){var e=this.options,l="";e.disableTime&&(e.endDate=Date.parse(new Date),l='<span class="time">最后更新时间：<em id="'+this.id+'time-em">'+t(e.endDate)+"</em></span>");var i=n.parseStringToHTML('<div id="'+this.pullDownId+'" data-class="pullDownId">    <span class="pullDownLabel inlineblock-span">'+e.pullDrefreshtxt+"</span>"+l+"</div>");this.children.insertBefore(i,this.children.firstChild),this.pullDownEle=this.children.firstChild,this.options.pullDownOffset=this.pullDownEle?this.pullDownEle.offsetHeight:0,this.createPullUpEle()},toggleClassText:function(t,e,l,i){t.setAttribute("class",e),t.querySelector("."+l).innerHTML=i},resizeAnimate:function(t){var e=this.iscroll,l=this.options.pullDownOffset;if(t){var i=-e.maxScrollY-l;-t<=i&&(t=-i)}else t=-l;e.scrollTo(0,t,300,IScroll.utils.ease.quadratic)},scrollEvent:function(){var e=this,l=this.options,i=this.iscroll,o=(this.pullUpId,this.pullDownEle),s=this.toggleClassText,r=l.pullDrefreshtxt,u=l.upLoadmoretxt,a=l.Realtimetxt,c=l.loadertxt,p=-l.pullDownOffset;this.ele.addEventListener("touchstart",function(t){t.returnValue=!0}),i.on("scrollStart",function(){var i=e.pullUpEle;e.startPullTime=(new Date).getTime(),l.disableTime&&(document.getElementById(e.id+"time-em").innerHTML=t(l.endDate)),o&&n.hasClass(o,"loading")?s(o,"","pullDownLabel",r):i&&n.hasClass(i,"loading")&&s(i,"","pullUpLabel",u)}),i.on("scrollMove",function(){var t=this.y,l=this.maxScrollY,i=e.pullUpEle,c=n.hasClass(o,"flip"),p=i&&n.hasClass(i,"flip");t>5&&!c?s(o,"flip","pullDownLabel",'<i class="icon-up"></i>'+a):t<5&&c?s(o,"","pullDownLabel",r):i&&t<l-5&&!p?s(i,"flip","pullUpLabel",'<i class="icon-down"></i>'+a):i&&t>l+5&&p&&s(i,"","pullUpLabel",u)}),i.on("scrollEnd",function(){var t=this.y,i=this.maxScrollY,r=e.pullUpEle,u=new Date;if(t===i&&r&&s(r,"flip","pullUpLabel",a),e.endPullTime=u.getTime(),e.totalGapTime=e.endPullTime-e.startPullTime,e.options.endDate=Date.parse(u),e.totalGapTime<200)return void(t>p&&t<1&&e.resizeAnimate());o&&n.hasClass(o,"flip")?(s(o,"loading","pullDownLabel",c),e.pullDownAction()):r&&n.hasClass(r,"flip")?(s(r,"loading","pullUpLabel",c),e.pullUpAction()):t>p&&t<1?e.resizeAnimate():-i>=-t&&i+l.pullUpOffset>t&&e.resizeAnimate(i+l.pullUpOffset)})},pullDownAction:function(t){var e=(new Date).getTime()-this.startPullTime,i=this,o=this.options,s=o.pullDownAction,r=o.pullDownActionStr;document.getElementById(i.id);n.isFunction(s)&&(this.iscroll||(l.listen(r,function(){i.createPullIScroll();var t={preventDefault:!1,startY:-o.pullDownOffset,mouseWheel:!0,listLoading:!0,scrollbars:!0};n.deepExtend(t,o.iscrollOptions),i.iscroll=new IScroll("#"+i.id,t),i.scrollEvent(),l.remove(r)}),s(function(){l.trigger(r)},t)),e>=400&&(l.listen(r,function(){i.refresh(!0);var t=i.pullUpEle;t?t.querySelector(".pullUpLabel").innerHTML=o.upLoadmoretxt:i.createPullUpEle(),setTimeout(function(){document.body.classList.remove("iscroll"),i.resizeAnimate(),i.iscroll.refresh(),l.remove(r)},1e3)}),s(function(){document.body.classList.add("iscroll"),l.trigger(r)},t)))},pullUpAction:function(){var t=this,e=(new Date).getTime()-t.startPullTime,i=t.options,o=i.pullUpAction,s=i.pullUpActionStr,r=t.iscroll;if(n.isFunction(o)){var u=r.y+i.pullUpOffset;e>=400?(l.listen(s,function(){t.refresh(!0);var e=t.pullUpEle,n=i.loaderendtxt;i.pullEnd?setTimeout(function(){document.body.classList.remove("iscroll"),t.resizeAnimate(u)},1e3):(document.body.classList.remove("iscroll"),n=i.upLoadmoretxt,r.refresh()),e.querySelector(".pullUpLabel").innerHTML=n,l.remove(s)}),o(function(t){document.body.classList.add("iscroll"),i.pullEnd=t,l.trigger(s)})):t.resizeAnimate(u)}},evt:function(t,e,l,i){var n="ontouchstart"in window,o=n?"touchstart":"mousedown",s=n?"touchend":"mouseup",r=n?"touchmove":"mousemove",u=n?"touchleave":"mouseout",a=function(t){var e={},l=t.originalEvent;return void 0==l&&(l=t),l.changedTouches?(e.pageX=l.changedTouches[0].pageX,e.pageY=l.changedTouches[0].pageY,e.clientX=l.changedTouches[0].clientX,e.clientY=l.changedTouches[0].clientY):(e.pageX=t.pageX,e.pageY=t.pageY,e.clientX=t.clientX,e.clientY=t.clientY),e.evt=t,e},c=function(t){return{x:t.clientX,y:t.clientY}},p=function(t,e){return t&&e?Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)):0},h=function(t,e,l){l(t,a(e))},f=function(t,e,l){l(t,a(e))},d=function(t,e,l){l(t,a(e))},m=function(t,e,l){l(t,a(e))},g=this.ele;switch(void 0==i&&(i=!0),e){case"mousemove":case"touchmove":i&&g.off(r,t),g.on(r,t,function(t){m(this,t,l)});break;case"click":case"tap":var v,y=function(t){var e=a(t);v=c(e)},w=function(t,e,i){var n=a(e),o=(Date.now(),c(n));p(v,o)<20&&h(t,e,l)};i&&(g.off(o,t),g.off(s,t)),g.on(o,t,function(t){2!=t.button&&y(t)}),g.on(s,t,function(t){2!=t.button&&w(this,t,l)});break;case"mousedown":case"touchstart":i&&g.off(o,t),g.on(o,t,function(t){f(this,t,l)});break;case"mouseup":case"touchend":i&&g.off(s,t),g.on(s,t,function(t){d(this,t,l)});break;case"mouseout":i&&g.off(u,t),g.on(u,t,function(t){w(t,l)})}}},e});